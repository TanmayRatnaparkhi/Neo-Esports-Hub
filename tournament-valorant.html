<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
<title>VALORANT Tournaments | Neo Esport Hub</title>
<script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- Navbar -->
 <header class="bg-black shadow-md sticky top-0 z-50 w-full">
    <div class="max-w-full mx-auto px-6 py-3 flex justify-between items-center text-2xl">
      <a href="#" class="text-3xl font-extrabold text-cyan-400 tracking-wide hover:text-white transition animate-glow">Neo Esports Hub</a>
      <nav class="hidden md:flex space-x-5 text-white font-semibold">
        <a href="index.html" class="hover:text-cyan-300 ">Home</a>
        <a href="create-tournament.html" class="hover:text-cyan-300">Tournaments</a>
        <a href="profile.html" class="hover:text-cyan-300">Profile</a>

      </nav>
      <div class="md:hidden">
        <button id="mobile-btn" class="text-cyan-400 text-2xl">☰</button>
      </div>
    </div>
    <div id="mobile-menu" class="hidden md:hidden px-4 pb-4 text-white bg-gray-800">
      <a href="index.html" class="block py-1 hover:text-cyan-300">Home</a>
      <a href="create-tournament.html" class="block py-1 hover:text-cyan-300">Tournaments</a>
      <a href="profile.html" class="block py-1 hover:text-cyan-300">Profile</a>
    </div>
  </header>

  <div class="bg-p2">

    <!-- HERO / Header image -->
    <section class="tournament-hero" aria-label="tournament hero">
      <img src="img/v-card.jpg" alt="Tournament Hero Banner">
      <div class="hero-content">
        <div class="hero-left">
          
          <h1>Events</h1>
          <div class="hero-links">
            <a class="hero-link" href="join-contestValo.html">How To Join A Contest ?</a>
             <a class="hero-link" href="#" id="openPopupBtn">Add Valorant Username & ID</a>
          </div>
        </div>

        <div class="hero-right">
          <a href="https://docs.google.com/forms/d/e/1FAIpQLSdnpg3PqKnIVoZGHn_VoeyK7qVRrdRMfLwTlHYEwO4bcBQbJg/viewform?usp=publish-editor"><button class="hero-cta1">CREATE TOURNAMENTS</button></a>
         <a href="mytournament.html">
  <button class="hero-cta2">MY TOURNAMENTS</button>
</a>

        </div>
      </div>
    </section>

    <!-- Tournaments grid -->
    <section>
      <div id="tournamentGrid" class="tournament-grid" aria-live="polite"></div>
    </section>
  </div>

  <div id="popupForm">
    <div class="popup-card">
      <h3>Add Valorant Player</h3>
      <input type="text" id="username" placeholder="Enter Username" required><br>
      <input type="text" id="gameId" placeholder="Enter Valorant ID" required><br>
      <button id="submitPlayer">Submit</button>
      <button id="closePopup">Cancel</button>
    </div>
    </div>

<!-- Room ID Popup -->
<div id="roomPopup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
  background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999;">
  <div style="background:#111; padding:25px; border-radius:10px; text-align:center; width:300px;">
    <h2 style="color:#00ffff;">Room Details</h2>
    <p><strong>Room ID:</strong> <span id="roomId"></span></p>
    <p><strong>Password:</strong> <span id="roomPass"></span></p>
    <button id="closeRoomPopup" style="background:#00ffff; border:none; color:#000; padding:10px 20px; border-radius:6px; cursor:pointer;">Close</button>
  </div>
</div>


  <script>

       /* ---------- TOURNAMENT DATA ---------- */
    const tournaments = [
      {
        id: 'VALO-101',
        title: 'VALORANT',
        banner: 'img/vl.png',
        platform: 'PC',
        badges: ['Featured', 'Leaderboard','Entry Fee - Free'],
        modes: '• Random Map • 5v5 •(Level Required Above - 20)',
        start: "01-10-2025 10:00 AM",
        prize: '₹100.00',
        progress: 0,
        total: 10,
        buttonLabel: 'Join Now',
        entryFee:0,
        closes: 'Victory is a click away'
      },
      {
        id: 'VALO-202',
        title: 'VALORANT',
        banner: 'img/vl.png',
        platform: 'PC',
        badges: ['Featured','Leaderboard','Entry Fee -₹25'],
        modes: '• Random Map • 5v5 •(Level Required Above - 20)',
        start: "01-10-2025 12:00 PM",
        prize: '₹150.00',
        progress: 0,
        total: 10,
        buttonLabel: 'Join Now',
        entryFee:25,
        closes: 'Victory is a click away'
      },
      {
        id: 'VALO-303',
        title: 'VALORANT',
        banner: 'img/vl.png',
        platform: 'PC',
        badges: ['Featured','Leaderboard','Entry Fee -₹30'],
        modes: '• Random Map • 5v5 •(Level Required Above - 20)',
        start: "01-10-2025 2:00 PM",
        prize: '₹200.00',
        progress: 0,
        total: 10,
        buttonLabel: 'Join Now',
        entryFee:30,
        closes: 'Victory is a click away'
      }
    ];
     //render tournaments cards
    const grid = document.getElementById('tournamentGrid');
       function percentOf(part,total){ 
      return (!total||total<=0)?0:Math.round(Math.max(0,Math.min(100,
      (part/total)*100))*100)/100; }
    
     
   function renderTournaments(){
    grid.innerHTML='';
       tournaments.forEach(t=> {
     const pct=percentOf(t.progress,t.total);
    const card=document.createElement('article');
    card.className='t-card'; 
     card.innerHTML=`
     <div class="t-banner">
     <img src="${t.banner}" alt="${t.title} banner">
     <div class="platform-badge">${t.platform}</div>
     </div>
     <div class="t-body">
     <div class="t-title">
     <h3>${t.title}</h3>
     <div class="t-id badge">${t.id}</div>
     </div>
     <div class="time"><strong>Start:</strong> ${t.start}</div>
     <div class="t-badges">${t.badges.map(b=>`<div class="badge">${b}</div>`).join('')}</div>
     <div class="modes">${t.modes}</div>
     <div class="progress-row">
     <div class="progress-text">${t.progress} / ${t.total} Players</div>
     <div class="progress-bar"><div class="progress-fill" style="width:${pct}%;"></div></div>
     </div>
     <div class="prize-join">
     <div class="prize">${t.prize}<small>Prize Pool</small></div>
     <button class="btn join" onclick="joinTournament('${t.id}')">${t.buttonLabel}</button>
     </div>
     </div>`;
     grid.appendChild(card);});
   }

    renderTournaments();
    
/* ---------- POPUP SCRIPT ---------- */
const popup = document.getElementById('popupForm');
const openBtn = document.getElementById('openPopupBtn');
const closeBtn = document.getElementById('closePopup');
const submitbtn = document.getElementById('submitPlayer');

let playerInfo = {};
const roomPopup = document.getElementById("roomPopup");
const roomIdSpan = document.getElementById("roomId");
const roomPassSpan = document.getElementById("roomPass");

// Open popup
openBtn.addEventListener('click', () => {
  popup.style.display = 'flex';
});

document.getElementById("closeRoomPopup").addEventListener("click", () => {
  roomPopup.style.display = "none";
});
 
// Close popup
closeBtn.addEventListener('click', () => {
  popup.style.display = 'none';
});

// Close if clicked outside the popup
popup.addEventListener('click', (e) => {
  if (e.target === popup) {
    popup.style.display = 'none';
  }
});

//submit btn 

  submitbtn.addEventListener('click',()=>{
    const username=document.getElementById('username').value.trim();
    const gameId=document.getElementById('gameId').value.trim();
    if(!username||!gameId){alert('Enter both Username & Game ID'); 
    return;}  
     playerInfo={username,gameId};
     alert('Your info has been added!');
    popup.style.display='none';
 });

 //join tournament 
   
  // ---------------- FULLY UPDATED JOIN FUNCTION ---------------- //
async function joinTournament(id) {

  // Check user login
  const user = auth.currentUser;
  if (!user) {
    alert("Please login first.");
    return;
  }

  // Get tournament data from Firestore
  const tourRef = doc(db, "tournaments", id);
  const tourSnap = await getDoc(tourRef);

  if (!tourSnap.exists()) {
    alert("Tournament not found.");
    return;
  }

  const tour = tourSnap.data();

  let playerInfo = {};
const roomPopup = document.getElementById("roomPopup");
const roomIdSpan = document.getElementById("roomId");
const roomPassSpan = document.getElementById("roomPass");


  // Check if user added username + gameId
  if (!playerInfo.username || !playerInfo.gameId) {
    alert("Please add your Username & Game ID first.");
    return;
  }

  // Check tournament full
  if (tour.joinedPlayers >= tour.totalPlayers) {
    alert("Tournament is full.");
    return;
  }

  // Payment for paid tournaments
  if (tour.entryFee > 0) {
    const ok = confirm(`Entry fee is ₹${tour.entryFee}. Proceed to pay?`);
    if (!ok) return;

    alert("Payment Successful!");
  }

  // ---------- SAVE USER IN joinedUsers SUBCOLLECTION ----------
  await setDoc(
    doc(db, "tournaments", id, "joinedUsers", user.uid),
    {
      username: playerInfo.username,
      gameId: playerInfo.gameId,
      joinAt: new Date(),
      paymentStatus: tour.entryFee > 0 ? "paid" : "free"
    }
  );

  // ---------- UPDATE JOINED PLAYERS COUNT ----------
  await updateDoc(tourRef, {
    joinedPlayers: increment(1)
  });

  // ---------- SAVE IN USER'S MY TOURNAMENTS ----------
  await setDoc(
    doc(db, "users", user.uid, "myTournaments", id),
    {
      title: tour.title,
      game: tour.game,
      startTime: tour.startTime,
      roomId: tour.roomId,
      roomPass: tour.roomPass,
      joinAt: new Date(),
      status: "joined"
    }
  );

  alert("You have joined the tournament successfully!");

  // ---------- SHOW ROOM POPUP IF WITHIN 15 MINUTES ----------
  const startTime = tour.startTime.toDate();
  const now = new Date();
  const diffMinutes = (startTime - now) / (1000 * 60);

  if (diffMinutes <= 15) {
    roomIdSpan.textContent = tour.roomId;
    roomPassSpan.textContent = tour.roomPass;
    roomPopup.style.display = "flex";
  }
}

   
   
    // mobile menu
    const mobileBtn = document.getElementById('mobile-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileBtn.addEventListener('click', ()=> mobileMenu.classList.toggle('hidden'));
  </script>
  <!-- <script type="module" src="js/firebase.js"></script>
<script type="module" src="js/tournament.js"></script> -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { 
    getFirestore, doc, getDoc, setDoc, updateDoc, increment 
} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

// -----------------------------------------------------
// 1. FIREBASE CONFIG (same as index.js)
// -----------------------------------------------------
const firebaseConfig = {
  apiKey: "AIzaSyB8Xl3RQMHUhsiJS4Kk2y64Rsnwoh3jVkI",
  authDomain: "neo-esports-hub.firebaseapp.com",
  projectId: "neo-esports-hub",
  storageBucket: "neo-esports-hub.firebasestorage.app",
  messagingSenderId: "1033553084106",
  appId: "1:1033553084106:web:33a391d3e7eb1faaae7e33",
  measurementId: "G-5952VXT79F"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);


// -----------------------------------------------------
// 2. FINAL UNIVERSAL JOIN FUNCTION (WORKS FOR ALL GAMES)
// -----------------------------------------------------
window.joinTournament = async function (tournamentId) {

    const user = auth.currentUser;
    if (!user) {
        alert("Please login first.");
        return;
    }

    // Player info saved in local storage
    const username = localStorage.getItem("username");
    const gameId = localStorage.getItem("game_id");
    const gameName = localStorage.getItem("current_game");

    if (!username || !gameId) {
        alert(`Please add your ${gameName} Username & ID first.`);
        return;
    }

    // Get tournament
    const tourRef = doc(db, "tournaments", tournamentId);
    const tourSnap = await getDoc(tourRef);

    if (!tourSnap.exists()) {
        alert("Tournament not found!");
        return;
    }

    const t = tourSnap.data();

    // Check if full
    if (t.joinedPlayers >= t.totalPlayers) {
        alert("Tournament is full!");
        return;
    }

    // --------------------------
    // 1. Save Player → joinedUsers
    // --------------------------
    await setDoc(doc(db, "tournaments", tournamentId, "joinedUsers", user.uid), {
        username,
        gameId,
        joinedAt: new Date()
    });

    // --------------------------
    // 2. Increase joinedPlayers
    // --------------------------
    await updateDoc(tourRef, {
        joinedPlayers: increment(1)
    });

    // --------------------------
    // 3. Save into User → myTournaments
    // --------------------------
    await setDoc(doc(db, "users", user.uid, "myTournaments", tournamentId), {
        title: t.title,
        game: t.game,
        startTime: t.startTime,
        roomId: t.roomId,
        roomPass: t.roomPass,
        status: "joined",
        joinedAt: new Date()
    });

    alert("You have successfully joined this tournament!");
};
</script>



</body>
</html>
